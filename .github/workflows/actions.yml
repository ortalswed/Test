name: Actions workflow
on: 
  push:
  #pull_request:
  #  types: [closed, assigned, opened, repoened]
env:
  WF_ENV: ${{secrets.ortal}}
jobs:
  node-version:
    strategy:
      matrix:
        os: [macos-latest, ubuntu-latest, windows-latest]
        node_version: [6, 8, 10]
    runs-on: ${{matrix.os}}
    steps:
     - name: Log node version
       run: node -v
     - uses: actions/setup-node@v1
       with: 
         node-version: ${{matrix.node_version}}
     - name: Log node version
       run: node -v

  setup-node:
    runs-on: ubuntu-latest
    steps:
      - name: Log node version
        run: node -v
      - uses: actions/setup-node@v1
        with:
          node-version: 6
      - name: Log node version
        run: node -v
  functions:
    runs-on: ubuntu-latest
    timeout-minutes: 180
    steps:
      - name: call github functions
        run: |
          echo ${{contains('hello','ll')}}
          echo ${{startsWith('hello','he')}}
          echo ${{endsWith('hello','lo')}}
          echo ${{format('hello {0} {1} {2}','World','!','!')}}
        continue-on-error: true

  create-issue:
    runs-on: ubuntu-latest
    steps:
      - name: Push a random file
        run: |
          pwd
          ls -a
          git init
          git remote add origin "https://$GITHUB.ACTOR:${{secrets.GITHUB_TOKEN}}@github.com/$GITHUB_REPOSITORY.git"
          git config --global user.name "ortal_swed"
          git config --global user.email "ortal80@gmail.com"
          git fetch
          git checkout master
          git branch --set-upstream-to=origin/master
          git pull
          ls -a
          echo random>>random.txt
          ls -a
          git add -A
          git commit -m "random file"
          git push
      - name: Create issue using Rest api
        run: |
          curl --request POST \
          --url https://api.github.com/repos/${{github.repository}}/issues \
          --header 'authorization: Bearer ${{ secrets.GITHUB_TOKEN }}' \
          --header 'content-type: application/json' \
          --data '{"title":"Automated issue for commit: ${{github.sha}}",
          "body": "This issue was automatically created by the Github Action workflow **${{ github.workflow }}**"}'

    

  run-github-actions:
    runs-on: ubuntu-latest
    steps:
      - name: list files before checkout
        run: |
          pwd
          ls -a
          echo "WF_ENV is ${WF_ENV}"
      - name: checkout
        uses: actions/checkout@v2
      - name: list files after checkout
        run: |
          pwd
          ls -a
          echo $GITHUB_SHA
          echo $GITHUB_REPOSITORY
          echo $GITHUB_WORKSPACE
      - name: simple JS Actions
        id: greet
        uses: actions/hello-world-javascript-action@v1.1
        with:
          who-to-greet: John
      - name: Log greeting time
        run: echo "${{steps.greet.outputs.time}}"

